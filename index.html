<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amigo Secreto</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 transition-all duration-300">

  <!-- BotÃµes de Modo Noturno e TraduÃ§Ã£o -->
  <div class="fixed top-5 right-5 flex space-x-2">
    <button id="nightModeButton" class="p-2 bg-gray-200 rounded-l-lg hover:bg-gray-900 text-black">
      ðŸŒ™
    </button>
    <button id="langSelector" class="p-2 bg-gray-200 rounded-r-lg hover:bg-gray-900 text-black hover:text-white">
      ðŸ‡§ðŸ‡·
    </button>
  </div>

  <!-- Popup de instruÃ§Ãµes -->
  <div id="instructionsPopup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
      <h2 class="text-2xl font-semibold mb-4">InstruÃ§Ãµes</h2>
      <p class="mb-4">VocÃª precisa estar logado no <a href="https://web.whatsapp.com" class="text-blue-500" target="_blank">WhatsApp Web</a> se estiver no computador, ou ter o <a href="https://www.whatsapp.com/download" class="text-blue-500" target="_blank">app do WhatsApp</a> instalado no celular para que possamos enviar as mensagens.</p>
      <p class="mb-4">AlÃ©m disso, permita popups para garantir que a mensagem seja enviada automaticamente.</p>
      <button id="closePopup" class="w-full p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Fechar</button>
    </div>
  </div>

  <!-- Container principal com o formulÃ¡rio -->
  <div class="max-w-lg mx-auto p-6 mt-24 bg-white shadow-lg rounded-xl">
    <h1 id="pageTitle" class="text-2xl font-semibold text-center mb-4">Organize Seu Amigo Secreto</h1>
    
    <div id="participants" class="space-y-4">
      <div class="participant space-y-2">
        <label for="name1" class="text-lg font-medium">Pessoa 1</label>
        <input type="text" id="name1" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Nome">
        <input type="tel" id="phone1" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Telefone">
      </div>
    </div>
    
    <button id="addPersonButton" class="w-full p-2 mt-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
      Adicionar Pessoa
    </button>

    <div class="mt-4">
      <label for="priceRange" class="text-lg font-medium">Valor do Presente</label>
      <select id="priceRange" class="w-full p-2 mt-2 border border-gray-300 rounded-lg">
        <option value="fixed">PreÃ§o Fixo</option>
        <option value="range">Intervalo de PreÃ§os</option>
      </select>
      
      <div id="priceInputs" class="space-y-2 mt-2 hidden">
        <input type="number" id="priceMin" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="PreÃ§o MÃ­nimo">
        <input type="number" id="priceMax" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="PreÃ§o MÃ¡ximo">
      </div>
      <div id="fixedPrice" class="space-y-2 mt-2">
        <input type="number" id="price" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="PreÃ§o Fixo">
      </div>
    </div>

    <textarea id="message" class="w-full p-2 mt-4 border border-gray-300 rounded-lg" placeholder="Escreva uma mensagem personalizada"></textarea>

    <button id="generateSecretSanta" class="w-full p-3 mt-6 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
      Criar Amigo Oculto
    </button>
  </div>

  <!-- Campo de DecodificaÃ§Ã£o -->
  <div class="max-w-lg mx-auto p-6 mt-10 bg-white shadow-lg rounded-xl">
    <h2 class="text-2xl font-semibold text-center mb-4">Decodificar</h2>
    <textarea id="decodeMessage" class="w-full p-2 mt-4 border border-gray-300 rounded-lg" placeholder="Cole aqui a mensagem criptografada"></textarea>
    <button id="decodeButton" class="w-full p-3 mt-6 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
      Decodificar
    </button>
    <p id="decodedMessage" class="mt-4 text-center text-lg text-gray-700"></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      let participantCount = 1;

      function updateTranslations() {
        const translations = {
          pt: {
            pageTitle: 'Organize Seu Amigo Secreto',
            // Adicione todos os textos e placeholders traduzidos
          },
          en: {
            pageTitle: 'Organize Your Secret Santa',
          },
        };

        const langElements = Object.entries(translations);
      }
    
      // Aplique funÃ§Ãµes comentadas para claro projeto
        const textElements = {
          pageTitle: 'pageTitle',
          addPersonText: 'Adicionar Pessoa',
          priceLabel: 'Valor do Presente',
          priceOption1: 'PreÃ§o Fixo',
          priceOption2: 'Intervalo de PreÃ§os',
          generateButtonText: 'Criar Amigo Oculto',
          personLabel: 'Pessoa',
          messagePlaceholder: 'Escreva uma mensagem personalizada',
        };

        Object.keys(textElements).forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = translations[currentLanguage][id] || element.textContent;
          }
        });
      }

      // Alternar entre idiomas
      document.getElementById('langSelector').addEventListener('click', function () {
        currentLanguage = currentLanguage === 'pt' ? 'en' : currentLanguage === 'en' ? 'es' : 'pt';
        updateTranslations();
        this.textContent = currentLanguage === 'pt' ? 'ðŸ‡§ðŸ‡·' : currentLanguage === 'en' ? 'ðŸ‡ºðŸ‡¸' : 'ðŸ‡ªðŸ‡¸';
      });

      // Modo Noturno
      document.getElementById('nightModeButton').addEventListener('click', function () {
        document.body.classList.toggle('bg-gray-900');
        document.body.classList.toggle('text-gray-100');
      });

      // Adicionar novas pessoas
      document.getElementById('addPersonButton').addEventListener('click', function () {
        participantCount++;
        const participantsDiv = document.getElementById('participants');
        const newParticipant = `
          <div class="participant space-y-2">
            <label for="name${participantCount}" class="text-lg font-medium">Pessoa ${participantCount}</label>
            <input type="text" id="name${participantCount}" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Nome">
            <input type="tel" id="phone${participantCount}" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Telefone">
          </div>
        `;
        participantsDiv.insertAdjacentHTML('beforeend', newParticipant);
      });

      // SeleÃ§Ã£o de preÃ§o
      document.getElementById('priceRange').addEventListener('change', function () {
        if (this.value === 'range') {
          document.getElementById('priceInputs').classList.remove('hidden');
          document.getElementById('fixedPrice').classList.add('hidden');
        } else {
          document.getElementById('priceInputs').classList.add('hidden');
          document.getElementById('fixedPrice').classList.remove('hidden');
        }
      });

      // FunÃ§Ã£o de criptografar o nome
      function encryptMessage(name) {
        return btoa(name); // Codifica para base64
      }

      // FunÃ§Ã£o de envio via WhatsApp com mensagem criptografada
      function sendWhatsAppMessage(name, phone, message) {
        const encryptedMessage = encryptMessage(name);
        const formattedMessage = `OlÃ¡ ${name}, seu amigo secreto Ã© *${encryptedMessage}*. ${message}`;
        const whatsappURL = `https://wa.me/${phone}?text=${encodeURIComponent(formattedMessage)}`;
        window.open(whatsappURL, '_blank');
      }

      // FunÃ§Ã£o para realizar o sorteio
      function generateSecretSanta() {
        const participants = [];
        const names = document.querySelectorAll('[id^="name"]');
        const phones = document.querySelectorAll('[id^="phone"]');

        names.forEach((nameInput, index) => {
          participants.push({
            name: nameInput.value,
            phone: phones[index].value
          });
        });

        // Embaralhar participantes
        const shuffledParticipants = [...participants];
        shuffledParticipants.sort(() => Math.random() - 0.5);

        // Impedir que alguÃ©m tire a si mesmo
        participants.forEach((participant, index) => {
          let secretSantaIndex = (index + 1) % participants.length;
          while (participants[secretSantaIndex].name === participant.name) {
            secretSantaIndex = (secretSantaIndex + 1) % participants.length;
          }

          const secretSanta = shuffledParticipants[secretSantaIndex];
          const message = `OlÃ¡ ${participant.name}, seu amigo secreto Ã© ${secretSanta.name}.`;
          sendWhatsAppMessage(participant.name, participant.phone, message);
        });
      }

      // Evento do botÃ£o para criar o sorteio
      document.getElementById('generateSecretSanta').addEventListener('click', generateSecretSanta);

      // Evento de decodificaÃ§Ã£o de mensagens
      document.getElementById('decodeButton').addEventListener('click', function () {
        const encryptedMessage = document.getElementById('decodeMessage').value;
        try {
          const decodedMessage = atob(encryptedMessage); // Decodifica mensagem
          document.getElementById('decodedMessage').textContent = `Mensagem decodificada: ${decodedMessage}`;
        } catch (error) {
          document.getElementById('decodedMessage').textContent = 'Erro ao decodificar a mensagem.';
        }
      });

      // Exibir o popup de instruÃ§Ãµes
      setTimeout(() => {
        document.getElementById('instructionsPopup').classList.remove('hidden');
      }, 1000);

      // Fechar o popup
      document.getElementById('closePopup').addEventListener('click', function () {
        document.getElementById('instructionsPopup').classList.add('hidden');
      });

      // Inicializar as traduÃ§Ãµes
      updateTranslations();
    });
  </script>

</body>
</html>
